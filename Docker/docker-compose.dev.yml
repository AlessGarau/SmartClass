services:
  smart-class-server-dev:
    build:
      context: ..
      dockerfile: Docker/Dockerfile.server.dev
    ports:
      - "3000:3000"
    volumes:
      - ../packages/server:/app/server
      - sm_dev_server_node_modules:/app/server/node_modules
    networks:
      - smart-class-network
    environment:
      - DATABASE_URL=postgresql://smartclass:root@smart-class-db-dev:5432/smart-class
      - JWT_SECRET=da024be3c25cc0134c2d5c207f1bad54
      - COOKIE_SECRET=secret-cookie-monster
      - MQTT_BROKER_URL=mqtt://admin-hetic.arcplex.tech:8823
      - DATA_API_URL=http://smart-class-data-dev:5001
      - WEEKLY_OPTIMIZATION_CRON=0 2 * * 0
      - ENABLE_SCHEDULED_OPTIMIZATION=true

  smart-class-db-dev:
    image: postgres:latest
    volumes:
      - "smart-class-db-postgres-data:/var/lib/postgresql/data:rw"
    environment:
      - POSTGRES_PASSWORD=root
      - POSTGRES_USER=smartclass
      - POSTGRES_DB=smart-class
    ports:
      - "5432:5432"
    expose:
      - "5432"
    networks:
      - smart-class-network

  smart-class-client-dev:
    build:
      context: ..
      dockerfile: Docker/Dockerfile.client.dev
    ports:
      - "5173:5173"
    volumes:
      - ../packages/client:/app/client
      - sm_dev_client_node_modules:/app/client/node_modules
    networks:
      - smart-class-network

  smart-class-data-dev:
    profiles:
      - data
    build:
      context: ..
      dockerfile: docker/Dockerfile.data
    ports:
      - "5001:5001"
    volumes:
      - ../packages/data:/app
    networks:
      - smart-class-network
    environment:
      - DATABASE_URL=postgresql://smartclass:root@smart-class-db-dev:5432/smart-class
      - FLASK_ENV=development
      - PORT=5001
      - SERVER_URL=http://smart-class-server-dev:3000
    depends_on:
      - smart-class-db-dev

volumes:
  sm_dev_server_node_modules:
  smart-class-db-postgres-data:
  sm_dev_client_node_modules:

networks:
  smart-class-network:
    driver: bridge